#' Code for extracting summary statistics from the comparative vulture project
#' Summarise the temporal resolution of the tracking data first 

#' Load the required packages
library(readr)
library(tidyverse)

#' Section 1: Load the data ----
data_path <- "track_resolution_summary"   # path to the data

files <- dir(data_path, pattern = "*.csv") # get file names

res_data <- files %>%
  # read in all the files, appending the path before the filename
  map(~ read_csv(file.path(data_path, .))) %>% 
  reduce(rbind)

res_data

#'export the combined summary stats table for the temporal resolution of the data
write.csv(res_data, file="track_resolution_summary/summary_all_tracks.csv", row.names = FALSE)

#' run some analyses on the data
#' extract data for birds that were tracked for over a year and remove some suspect data
#'the double releases from Kerri

nonWantedLevels<-c("AG382", "AM89", "AM88", "AM87")
subset <- res_data %>% filter(!id %in% nonWantedLevels)
levels(as.factor(subset$id))
subset <- filter(subset, duration > 365)
ggplot(data = subset, mapping = aes(x = species, y = kde)) + geom_boxplot() + ylab("KDE 95%")
subset %>% group_by(species) %>% summarize(mean_kde = mean(kde))
subset %>% group_by(species) %>% summarize(max_kde = max(kde))
filter(subset, species == "cv") %>% summarize(maxkde = max(kde))
