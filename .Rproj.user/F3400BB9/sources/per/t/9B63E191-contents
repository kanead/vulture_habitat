#' run the wolf sheep example from the nlrx paper
#' The nlrx r package: A next‚Äêgeneration framework for reproducible NetLogo model analyses
#' https://besjournals.onlinelibrary.wiley.com/doi/epdf/10.1111/2041-210X.13286
#' https://github.com/ropensci/nlrx

library(nlrx)

nl <- nl(
  nlversion = "6.0.4",
  nlpath = "C:/Program Files/NetLogo 6.0.4/",
  modelpath = "C:/Program Files/NetLogo 6.0.4/app/models/Sample Models/Biology/Wolf Sheep Predation.nlogo",
  jvmmem = 1024
)

outpath <-
  file.path("C:/Users/Adam/Documents/Science/Methods & Stats/nlrx package")


#' attaching an experiment
nl@experiment <- experiment(
  expname = "wolf-sheep",
  outpath = outpath,
  repetition = 1,
  tickmetrics = "true",
  idsetup = "setup",
  idgo = "go",
  runtime = 50,
  evalticks = seq(40, 50),
  metrics = c(
    "count sheep",
    "count wolves",
    "count patches with [pcolor = green]"
  ),
  variables = list(
    'initial-number-sheep' = list(min = 50, max = 150, qfun = "qunif"),
    'initial-number-wolves' = list(min =
                                     50, max = 150, qfun = "qunif")
  ),
  constants = list(
    "model-version" = "\"sheep-wolves-grass\"",
    "grass-regrowth-time" = 30,
    "sheep-gain-from-food" = 4,
    "wolf-gain-from-food" = 20,
    "sheep-reproduce" = 4,
    "wolf-reproduce" = 5,
    "show-energy?" = "false"
  )
)

#' attaching a Sobol simdesign
nl@simdesign <- simdesign_lhs(nl=nl,
                              samples=100,
                              nseeds=3,
                              precision=3)
#' run simulations
results <- run_nl_all(nl)

# Attach results to nl object:
setsim(nl, "simoutput") <- results

# Write output to outpath of experiment within nl
write_simoutput(nl)

# Do further analysis:
analyze_nl(nl)

head(results)
tail(results)
max(results$`[run number]`)
